{% extends 'base/base.html' %}
{% block title %}Order Details{% endblock title%}
{% load static %} {% block start %}

{% block footer %}{% endblock %}

<section class="section-content padding-y">
  <div class="container">
    <!-- Header Section -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="order-header d-flex justify-content-between align-items-center p-4 rounded-lg shadow-sm">
          <div>
            <h2 class="order-title mb-2">Order Details</h2>
            <p class="order-subtitle mb-0">Order #{{ order.order_id }}</p>
          </div>
          <a href="{% url 'download_invoice' order.order_id %}" class="btn btn-primary download-invoice-btn">
            <i class="fas fa-download me-2"></i>Download Invoice
          </a>
        </div>
      </div>
    </div>

    <!-- Order Items Section -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="card modern-card">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="fas fa-shopping-bag me-2"></i>Order Items
            </h4>
          </div>
          <div class="card-main-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-header">
                  <tr>
                    <th class="border-0">Product</th>
                    <th class="border-0">Size</th>
                    <th class="border-0">Color</th>
                    <th class="border-0">Quantity</th>
                    <th class="border-0 text-end">Price</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in order_items.all %}
                  <tr class="order-item-row">
                    <td class="py-3">
                      <a href="{% url 'get_product' item.product.slug %}" class="product-link">
                        {{ item.product.product_name }}
                      </a>
                    </td>
                    <td class="py-3">
                      <span class="size-badge">{{ item.size_variant.size_name|default:"N/A" }}</span>
                    </td>
                    {% if item.size_variant %}
                    {% for color in item.product.color_variant.all %}
                    <td class="py-3">
                      <span class="color-badge">{{ color.color_name|default:"N/A" }}</span>
                    </td>
                    {% endfor %}
                    {% endif %}
                    <td class="py-3">
                      <span class="quantity-badge">{{ item.quantity }}</span>
                    </td>
                    <td class="py-3 text-end">
                      <span class="price-text">₹{{ item.product_price }}</span>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Information and Payment Summary -->
    <div class="row">
      <!-- Order Information -->
      <div class="col-lg-8 mb-4">
        <div class="card modern-card">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="fas fa-info-circle me-2"></i>Order Information
            </h4>
          </div>
          <div class="card-main-body">
            <div class="order-info-grid">
              <div class="info-item">
                <div class="info-label">Order ID</div>
                <div class="info-value">{{ order.order_id }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Order Date</div>
                <div class="info-value">{{ order.order_date|date:"F j, Y" }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Customer</div>
                <div class="info-value">
                  {% if order.user.first_name or order.user.last_name %}
                  {{ order.user.first_name }} {{ order.user.last_name }}
                  {% elif order.user.get_full_name %}
                  {{ order.user.get_full_name }}
                  {% else %}
                  {{ order.user.username }}
                  {% endif %}
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Payment Status</div>
                <div class="info-value">
                  <span
                    class="status-badge {% if order.payment_status == 'Paid' %}status-success{% else %}status-warning{% endif %}">
                    {{ order.payment_status }}
                  </span>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Payment Mode</div>
                <div class="info-value">{{ order.payment_mode }}</div>
              </div>
              <div class="info-item full-width">
                <div class="info-label">Shipping Address</div>
                <div class="info-value">{{ order.shipping_address|default:"Not Provided" }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Summary -->
      <div class="col-lg-4 mb-4">
        <div class="card modern-card payment-summary-card">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="fas fa-receipt me-2"></i>Payment Summary
            </h4>
          </div>
          <div class="card-main-body">
            <div class="summary-item">
              <span class="summary-label">Subtotal</span>
              <span class="summary-value">₹{{ order.order_total_price }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Coupon Discount</span>
              <span class="summary-value discount-value">-₹{{ order.coupon.discount_amount|default:"0" }}</span>
            </div>
            <hr class="summary-divider">
            <div class="summary-item total-item">
              <span class="summary-label">Grand Total</span>
              <span class="summary-value total-value">₹{{ order.grand_total }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Unified Color System */
  :root {
    --primary-color: #6366f1;
    --accent-color: #fbbf24;
    --text-dark: #1e293b;
    --text-muted: #64748b;
    --bg-light: #f8fafc;
    --border-light: #e2e8f0;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  /* Header Styles */
  .order-header {
    background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
    color: white;
    border: none;
  }

  .order-title {
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0;
  }

  .order-subtitle {
    font-size: 1rem;
    opacity: 0.9;
    font-weight: 500;
  }

  /* Modern Card Styles */
  .modern-card {
    border: none;
    border-radius: 16px;
    box-shadow: var(--shadow-md);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .modern-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .modern-card .card-header {
    background: var(--bg-light);
    border-bottom: 2px solid var(--border-light);
    padding: 1.5rem;
  }

  .card-title {
    color: var(--text-dark);
    font-weight: 600;
    font-size: 1.25rem;
  }

  .card-title i {
    color: var(--primary-color);
  }

  .card-main-body {
    padding: 1.5rem;
  }

  /* Table Styles */
  .table-header th {
    background: var(--bg-light);
    color: var(--text-dark);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.875rem;
    letter-spacing: 0.05em;
    padding: 1rem;
  }

  .order-item-row {
    transition: all 0.2s ease;
  }

  .order-item-row:hover {
    background: var(--bg-light);
  }

  .product-link {
    color: var(--text-dark);
    font-weight: 600;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .product-link:hover {
    color: var(--primary-color);
  }

  /* Badge Styles */
  .size-badge,
  .color-badge,
  .quantity-badge {
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .quantity-badge {
    background: var(--accent-color);
    color: var(--text-dark);
  }

  .price-text {
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--text-dark);
  }

  /* Order Info Grid */
  .order-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .info-item {
    padding: 1rem;
    background: var(--bg-light);
    border-radius: 12px;
    border-left: 4px solid var(--primary-color);
  }

  .info-item.full-width {
    grid-column: 1 / -1;
  }

  .info-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    font-weight: 500;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .info-value {
    font-size: 1rem;
    color: var(--text-dark);
    font-weight: 600;
  }

  /* Status Badge */
  .status-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .status-success {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
    border: 1px solid var(--success-color);
  }

  .status-warning {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
    border: 1px solid var(--warning-color);
  }

  /* Payment Summary */
  .payment-summary-card {
    position: sticky;
    top: 2rem;
  }

  .summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
  }

  .summary-label {
    color: var(--text-muted);
    font-weight: 500;
  }

  .summary-value {
    color: var(--text-dark);
    font-weight: 600;
  }

  .discount-value {
    color: var(--success-color);
  }

  .summary-divider {
    border-color: var(--border-light);
    margin: 1rem 0;
  }

  .total-item {
    background: var(--bg-light);
    margin: 0 -1.5rem -1.5rem;
    padding: 1.5rem;
    border-radius: 0 0 16px 16px;
  }

  .total-item .summary-label {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-dark);
  }

  .total-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-color);
  }

  /* Button Styles */
  .download-invoice-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .download-invoice-btn:hover {
    background: var(--accent-color);
    border-color: var(--accent-color);
    color: var(--text-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .order-header {
      flex-direction: column;
      text-align: center;
      gap: 1rem;
    }

    .order-title {
      font-size: 1.5rem;
    }

    .order-info-grid {
      grid-template-columns: 1fr;
    }

    .payment-summary-card {
      position: static;
    }

    .modern-card .card-header {
      padding: 1rem;
    }

    .card-title {
      font-size: 1.1rem;
    }
  }

  /* Utility Classes */
  .rounded-lg {
    border-radius: 16px !important;
  }
</style>

{% endblock %}